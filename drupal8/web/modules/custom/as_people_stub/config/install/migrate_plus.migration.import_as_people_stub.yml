# Migration configuration for imported stats.
id: import_as_people_stub
label: Migrate stats from D7 AS to D8 AS
migration_group: people
dependencies:
  enforced:
    module:
      - as_people_stub

destination:
  plugin: entity:page_component_entity

source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: json
  constants:
    person_base_path: '/people'

  urls: https://as.cornell.edu/people-json

  ids:
    netid:
      type: string

  fields:
    -
      name: uuid
      label: 'uuid'
      selector: uuid
    -
      name: netid
      label: 'NetID'
      selector: /node/person_netid
    -
      name: title
      label: 'Title'
      selector: title
    -
      name: field_person_type
      label: 'Person Type'
      selector: field_person_type
    -
      name: field_departments_programs
      label: 'Departments and Programs'
      selector: field_departments_programs
    -
      name: field_keywords
      label: 'Keywords'
      selector: field_keywords
    -
      name: link
      label: 'Link'
      selector: view_node


process:
  type:
    plugin: default_value
    default_value: person
  name: title
  field_netid: netid
  field_people_uuid: uuid
  'field_link/uri':
    plugin: concat
    source:
      - 'person_base_path'
      - link
  field_person_type:
    plugin: entity_lookup
    source: field_person_type
  field_department_program:
    -
      plugin: skip_on_empty
      method: process
      source: field_departments_programs
    -
      plugin: explode
      delimiter: ','
  field_keywords: field_keywords
  uid:
    plugin: default_value
    default_value: 1
