# Migration configuration for imported articles.
id: import_as_articles
label: Migrate articles from D7 AS to D8 AS
migration_group: articles
migration_dependencies:
  require:
    - import_as_article_images
dependencies:
  enforced:
    module:
      - as_migrate_articles

destination:
  plugin: entity:node

source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: json

  urls: http://as.cornell.edu/articles-asd8-json

  ids:
    nid:
      type: integer

  item_selector: articles

  fields:
    -
      name: nid
      label: 'Nid'
      selector: /article/nid
    -
      name: vid
      label: 'Vid'
      selector: /article/vid
    -
      name: uuid
      label: 'Uuid'
      selector: /article/uuid
    -
      name: title
      label: 'Title'
      selector: /article/title
    -
      name: created
      label: 'Created'
      selector: /article/created
    -
      name: changed
      label: 'Changed'
      selector: /article/changed
    -
      name: status
      label: 'Status'
      selector: /article/status
    -
      name: path
      label: 'Path'
      selector: /article/path
    -
      name: summary
      label: 'Summary'
      selector: /article/summary
    -
      name: body
      label: 'Body'
      selector: /article/description
    -
      name: field_byline
      label: 'Field Byline'
      selector: /article/field_byline
    -
      name: field_media_source
      label: 'Field Media Source'
      selector: /article/field_media_source
    -
      name: field_dateline
      label: 'Field dateline'
      selector: /article/field_dateline
    -
      name: field_department_program
      label: 'Field Department Program'
      selector: /article/field_department_program
    -
      name: field_card_label
      label: 'Field Card Label'
      selector: /article/field_card_label
    -
      name: field_topic
      label: 'Field Topic'
      selector: /article/field_topic
    -
      name: field_article_view_tags
      label: 'Field Article View Tags'
      selector: /article/field_article_view_tags



process:
  type:
    plugin: default_value
    default_value: article

  uuid: uuid
  title: title
  created: created
  changed: changed
  path: path

  'body/value': body

  'body/format':
    plugin: default_value
    default_value: full_html

  'field_topics_and_disciplines':
    -
      plugin: skip_on_empty
      method: process
      source: field_topic
    -
      plugin: explode
      source: field_topic
      delimiter: /

  'field_department_program/tid':
    -
      plugin: skip_on_empty
      method: process
      source: field_department_program
    -
      plugin: explode
      source: field_department_program
      delimiter: /
    -
      plugin: migration
      migration: import_as_article_departments_programs
      source: nid

  field_byline: field_byline
  field_media_source: field_media_source
  field_dateline: field_dateline
  field_card_label: field_card_label
  'field_image/target_id':
    plugin: migration
    migration: import_as_article_images
    source: nid

  'field_image/alt': title

  uid:
    plugin: default_value
    default_value: 1
